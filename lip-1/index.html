<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.53">


<title data-react-helmet="true">Off-chain API | Libra Improvement Proposals</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Off-chain API | Libra Improvement Proposals"><meta data-react-helmet="true" name="description" content="# Summary"><meta data-react-helmet="true" property="og:description" content="# Summary"><meta data-react-helmet="true" property="og:url" content="https://lip.libra.org/lip-1">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.182e80ce.css">


<link rel="preload" href="/styles.dec398a8.js" as="script">

<link rel="preload" href="/runtime~main.a042d6de.js" as="script">

<link rel="preload" href="/main.ed02c268.js" as="script">

<link rel="preload" href="/1.a2c692f0.js" as="script">

<link rel="preload" href="/1be78505.7f9abe94.js" as="script">

<link rel="preload" href="/ec1ed54d.642a5f79.js" as="script">

<link rel="preload" href="/17896441.c49eb8c6.js" as="script">

<link rel="preload" href="/c0102118.a83626c9.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<div><nav aria-label="Libra cross-domain nav" class="root_1que"><div class="root_1P_1"><div class="width-wrapper libra-org-width"><div class="mobile-only"><div class="mainContainer_l_dZ"><div><svg width="22" height="22" class="root_AGgq"><g fill="none" fill-rule="evenodd"><circle fill="#D8D8D8" opacity="0.013" cx="11" cy="11" r="11"></circle><path d="M8 7.75a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm0 4.75a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm0 4.75a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" fill="#39298C" fill-rule="nonzero"></path></g></svg></div><a href="https://libra.org"><svg fill="#42318C" class="logo_n7uz" viewBox="0 0 1229.78 330.24" alt="Libra Logo"><path d="M314.82 292.65a192 192 0 0023.31-32.92l-39.45-19.64A120.78 120.78 0 01278 266c-11 10.21-22.7 16.16-34.61 17.68-23 2.94-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.66-65.44 37.39A191.89 191.89 0 000 306.13l39.44 19.64a121.7 121.7 0 0120.64-25.93c10.88-10.07 22.52-16 34.62-17.51a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92l-39.45-19.64A121 121 0 01278 148.53c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.65-65.44 37.39A191.5 191.5 0 000 188.65l39.44 19.64a122 122 0 0120.64-25.94C71 172.29 82.6 166.4 94.7 164.85a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92L298.68 5.13A121 121 0 01278 31.05c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.6-15.8-52.51-33.71-92.12-28.65C64.72 4 42.7 16.52 23.32 38.26A191.5 191.5 0 000 71.17l39.44 19.64a122 122 0 0120.64-25.94C71 54.81 82.6 48.92 94.7 47.37a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.64 33.14 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zM452.56 5.45v321.16H407V5.45zm48.09 92.44v228.72h45.6V97.89zM929.5 150.7c18.77-12.62 40.86-16.24 63-12.71v-39.8a125.23 125.23 0 00-15.42-1c-31.27 0-56.07 9.56-68 26.22l-5.6 7.78V97.63h-45.64v229h45.37v-79.58c0-14.57-.16-26.82 0-41.39.29-24.04 8.39-42.91 26.29-54.96zm300.28 175.91v-229h-42.41v25.15l-5.1-4.39c-19.87-17.1-43.94-25.77-71.54-25.77-20.55 0-39.9 5-56 14.58-37 21.87-59 61.09-59 104.92s21.88 82.74 58.53 104.42c15.9 9.44 37.38 15.08 57.46 15.08 26.92 0 52-9.14 70.49-25.73l5.15-4.61v25.33zm-60.51-57.25a73.75 73.75 0 01-51.27 23.35c-.92 0-1.82.05-2.71.05-45.5 0-81.14-35.42-81.14-80.64 0-21.28 7.64-41.26 21.52-56.26 14.55-15.72 34.84-24.38 57.12-24.38 1 0 2.1 0 3.16.05a75.59 75.59 0 0152.75 23.78 78.06 78.06 0 0121.52 54v7.44a76.41 76.41 0 01-20.95 52.61zm-455.89 62.26c20.55 0 39.9-5 56-14.58 37-21.87 59-61.09 59-104.92s-21.88-82.74-58.53-104.42c-15.9-9.44-37.39-15.08-57.47-15.08-26.91 0-51.94 9.14-70.49 25.74l-5.15 4.6V5.45h-42.4v321.16h42.4v-25.15l5.11 4.39c19.87 17.15 43.94 25.77 71.53 25.77zM633.94 215v-7.44a76.46 76.46 0 0120.9-52.64 73.78 73.78 0 0151.33-23.35c.91 0 1.81-.05 2.71-.05 45.5 0 81.14 35.42 81.14 80.64 0 21.28-7.65 41.26-21.53 56.26-14.55 15.72-34.83 24.38-57.11 24.38-1 0-2.11 0-3.16-.05a75.61 75.61 0 01-52.76-23.78A78.11 78.11 0 01633.94 215zM546.25 5.45h-45.6V51h45.6z"></path></svg></a><a class="cornerLink_3bMt" href="https://libra.org/white-paper/"><svg width="45" height="46"><defs><circle id="white-paper_svg__a" cx="18" cy="18" r="18"></circle></defs><g fill="none" fill-rule="evenodd"><g transform="translate(5.5)"><mask id="white-paper_svg__b" fill="#fff"><use xlink:href="#white-paper_svg__a"></use></mask><use fill="#FAFAFA" xlink:href="#white-paper_svg__a"></use><g mask="url(#white-paper_svg__b)"><path fill="#706AAF" d="M1.555 11.624l25.862-4.089 5.343 33.676L6.897 45.3z"></path><path fill="#42318C" d="M4.57 8.377L30.654 6.1l2.977 33.966-26.086 2.278z"></path><path fill="#EFEFEF" d="M7.948 5.25h26.195v34.162H7.948z"></path><path fill="#AEAEAE" d="M11.086 11.889h11.045v1H11.086zM11.147 15.511h15.391v1h-15.39zM11.086 17.14h19.435v1H11.086zM11.086 18.83h8.208v1h-8.208zM11.086 22.814h7.001v1h-7zM11.147 24.504h15.27v1h-15.27zM11.147 29.393h15.27v1h-15.27zM11.086 26.073h8.208v1h-8.208zM11.086 27.703H23.46v1H11.086zM20.743 26.073h9.778v1h-9.778zM20.743 18.83h8.208v1h-8.208z"></path></g></g><text font-family="NBInternationalPro-Reg, NB International Pro" font-size="8" fill="#39298C" transform="translate(-1)"><tspan x="1.664" y="44">White Paper</tspan></text></g></svg></a></div></div><div class="root_1O4E desktop-only"><a class="logo_n7uz" href="https://libra.org"><svg fill="#42318C" class="logo_svg__Logo" viewBox="0 0 1229.78 330.24" alt="Libra Logo"><path d="M314.82 292.65a192 192 0 0023.31-32.92l-39.45-19.64A120.78 120.78 0 01278 266c-11 10.21-22.7 16.16-34.61 17.68-23 2.94-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.66-65.44 37.39A191.89 191.89 0 000 306.13l39.44 19.64a121.7 121.7 0 0120.64-25.93c10.88-10.07 22.52-16 34.62-17.51a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92l-39.45-19.64A121 121 0 01278 148.53c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.65-65.44 37.39A191.5 191.5 0 000 188.65l39.44 19.64a122 122 0 0120.64-25.94C71 172.29 82.6 166.4 94.7 164.85a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92L298.68 5.13A121 121 0 01278 31.05c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.6-15.8-52.51-33.71-92.12-28.65C64.72 4 42.7 16.52 23.32 38.26A191.5 191.5 0 000 71.17l39.44 19.64a122 122 0 0120.64-25.94C71 54.81 82.6 48.92 94.7 47.37a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.64 33.14 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zM452.56 5.45v321.16H407V5.45zm48.09 92.44v228.72h45.6V97.89zM929.5 150.7c18.77-12.62 40.86-16.24 63-12.71v-39.8a125.23 125.23 0 00-15.42-1c-31.27 0-56.07 9.56-68 26.22l-5.6 7.78V97.63h-45.64v229h45.37v-79.58c0-14.57-.16-26.82 0-41.39.29-24.04 8.39-42.91 26.29-54.96zm300.28 175.91v-229h-42.41v25.15l-5.1-4.39c-19.87-17.1-43.94-25.77-71.54-25.77-20.55 0-39.9 5-56 14.58-37 21.87-59 61.09-59 104.92s21.88 82.74 58.53 104.42c15.9 9.44 37.38 15.08 57.46 15.08 26.92 0 52-9.14 70.49-25.73l5.15-4.61v25.33zm-60.51-57.25a73.75 73.75 0 01-51.27 23.35c-.92 0-1.82.05-2.71.05-45.5 0-81.14-35.42-81.14-80.64 0-21.28 7.64-41.26 21.52-56.26 14.55-15.72 34.84-24.38 57.12-24.38 1 0 2.1 0 3.16.05a75.59 75.59 0 0152.75 23.78 78.06 78.06 0 0121.52 54v7.44a76.41 76.41 0 01-20.95 52.61zm-455.89 62.26c20.55 0 39.9-5 56-14.58 37-21.87 59-61.09 59-104.92s-21.88-82.74-58.53-104.42c-15.9-9.44-37.39-15.08-57.47-15.08-26.91 0-51.94 9.14-70.49 25.74l-5.15 4.6V5.45h-42.4v321.16h42.4v-25.15l5.11 4.39c19.87 17.15 43.94 25.77 71.53 25.77zM633.94 215v-7.44a76.46 76.46 0 0120.9-52.64 73.78 73.78 0 0151.33-23.35c.91 0 1.81-.05 2.71-.05 45.5 0 81.14 35.42 81.14 80.64 0 21.28-7.65 41.26-21.53 56.26-14.55 15.72-34.83 24.38-57.11 24.38-1 0-2.11 0-3.16-.05a75.61 75.61 0 01-52.76-23.78A78.11 78.11 0 01633.94 215zM546.25 5.45h-45.6V51h45.6z"></path></svg></a><ul class="right_1CGF"><li class="root_1cxV default_2wmT"><a href="https://libra.org/vision/" target="_self">Vision</a></li><li class="root_1cxV default_2wmT"><a href="https://libra.org/association/" target="_self">Association</a></li><li class="root_1cxV default_2wmT"><a href="https://libra.org/developers/" target="_self">Developers</a></li><li class="root_1cxV default_2wmT"><a href="https://libra.org/learn-faqs/" target="_self">Learn</a></li><li class="root_1cxV default_2wmT"><a href="https://libra.org/media-press-news/" target="_self">Media</a></li><li class="root_1cxV cta_2YWP"><a href="https://libra.org/white-paper/" target="_self">White Paper</a></li></ul></div></div></div><div class="root_1l9q"><div class="width-wrapper libra-org-width"><div class="mobile-only"><div class="mainContainer_2dgw"><div class="root_1-Sv"><span class="primary_mHKq"><b>Developers</b></span><span class="divider_WDIF"> / </span><span class="secondary_1Lwp">Governance</span></div><div><svg width="22" height="22" class="root_AGgq"><g fill="none" fill-rule="evenodd"><circle fill="#D8D8D8" opacity="0.015" cx="11" cy="11" r="11"></circle><path d="M11.266 13.869L15.89 9.28a.375.375 0 000-.531l-.62-.619a.375.375 0 00-.53 0L11 11.834 7.26 8.131a.375.375 0 00-.532 0l-.619.619a.375.375 0 000 .531l4.625 4.588a.375.375 0 00.532 0z" fill="#354052" fill-rule="nonzero"></path></g></svg></div></div></div><div class="root_2rvH desktop-only"><div class="root_1-Sv"><span class="primary_mHKq"><b>Developers</b></span><span class="divider_WDIF"> / </span><span class="secondary_1Lwp">Governance</span></div><ul class="right_2kul"><li class="root_1cxV default_2wmT"><a href="https://libra.org/developers/" target="_self">Overview</a></li><li class="root_1cxV default_2wmT"><a href="https://developers.libra.org/docs/welcome-to-libra" target="_self">Libra Docs</a></li><li class="root_1cxV default_2wmT active"><a href="https://lip.libra.org/" target="_self">Governance</a></li><li class="root_1cxV default_2wmT"><a href="https://community.libra.org/" target="_self">Community</a></li><li class="root_1cxV default_2wmT"><a href="https://github.com/libra/" target="_blank">Github</a></li></ul></div></div></div></nav><div class="navSpacer_3fKt"></div></div><div class="navPusher_36Co"><div class="main-wrapper width-wrapper"><div class="docPage_1jis"><div class="docSidebarContainer_1kjN"><nav aria-label="intra-site navigation" class="sidebar_3y9u"><div class="menu menu--responsive menu_1rsy"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list menuList_3BMp"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div><li class="menu__list-item listItem_2soo home_1kuD home main-sidebar-icon"><a class="menu__link menuLink_1_QM withBackgroundImage_2NV6" style="background-image:url(&#x27;/img/overview.png&#x27;)" href="/overview"><span>Overview</span></a></li><li class="menu__list-item listItem_2soo category_30QN" style="background-image:url(&#x27;&#x27;)"><ul class="menu__list lip-category"><li class="categoryTitle_2-gS"><a class="menu__link menuLink_1_QM">LIPS</a></li><li class="menu__list-item listItem_2soo main-sidebar-icon background-contain main-sidebar-all-lips"><a class="menu__link menuLink_1_QM withBackgroundImage_2NV6" style="background-image:url(&#x27;/img/all-lips.png&#x27;)" tabindex="0" href="/all-lips"><span>All LIPs</span></a></li><li class="menu__list-item listItem_2soo main-sidebar-icon"><a class="menu__link menuLink_1_QM withBackgroundImage_2NV6" style="background-image:url(&#x27;/img/standard-lips.svg&#x27;)" tabindex="0" href="/standard-lips"><span>Standard LIPs</span></a></li><li class="menu__list-item listItem_2soo main-sidebar-icon background-contain"><a class="menu__link menuLink_1_QM withBackgroundImage_2NV6" style="background-image:url(&#x27;/img/process-lips.png&#x27;)" tabindex="0" href="/process-lips"><span>Process LIPs</span></a></li><li class="menu__list-item listItem_2soo main-sidebar-icon lip-info-icon"><a class="menu__link menuLink_1_QM withBackgroundImage_2NV6" style="background-image:url(&#x27;/img/info-lips.svg&#x27;)" tabindex="0" href="/info-lips"><span>Informational LIPs</span></a></li></ul></li></ul></div></nav></div><main class="docMainContainer_3j_A"><div class="container docItemWrapper_1Hme"><div><div class="docItemContainer_1tAC"><article><header id="header"><h2 class="docTitle_cWlf"><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="Off-chain API"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#Off-chain API" title="Direct link to heading">#</a>Off-chain API</h2></header><div id="metadata-table"><table class="metadataTable_2VQe"><tbody><tr><td>LIP</td><td>1</td></tr><tr><td>Title</td><td>Off-chain API</td></tr><tr><td>Author</td><td><a href="https://github.com/kphfb" target="_blank">Kevin Hurley (@kphfb)</a>,  Dmitry Pimenov,  George Danezis</td></tr><tr><td>Status</td><td>Final</td></tr><tr><td>Type</td><td>Informational</td></tr><tr><td>Created</td><td>05/29/2020</td></tr></tbody></table></div><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="summary"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#summary" title="Direct link to heading">#</a>Summary</h1><hr><p>The Off-Chain Protocol is an API and payload specification that could be used to support compliance, privacy and scalability on blockchains. Note that this API is being published by the Libra Association on an “as is” basis.  Publication of this API by the Libra Association does not mean that the Association is taking any position on whether the API addresses issues of compliance, privacy and scalability.  Users of this API must make such determinations on their own.</p><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="abstract--motivation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#abstract--motivation" title="Direct link to heading">#</a>Abstract / Motivation</h1><hr><p>The Off-Chain Protocol is an API and payload specification to support compliance, privacy and scalability on blockchains. It is executed between a pair of entities and allows them to privately exchange payment information before, while, or after settling it on a Blockchain.  The entities can be inclusive of designated dealers (DDs) and <em>Virtual Asset Service Providers</em> (VASPs), such as wallets or exchanges.</p><p>The initial use-case for the Off-Chain Protocol relates to <em>supporting compliance</em>, and in particular supporting the implementation of the <em>Travel Rule</em> requirements that VASPs may be required to follow. Those requirements generally specify that when money transfers above a certain amount are executed by VASPs, some information about the sender and recipient of funds must become available to both VASPs. The Off-Chain Protocols allows VASPs to exchange this information privately.</p><p>A secondary use-case for the Off-Chain Protocol is to provide higher levels of privacy than those that can be achieved directly on a Blockchain. The exact details of the customer accounts involved in a payment, as well as personal information that may need to be exchanged to support compliance, remain off-chain. The information is exchanged within a secure, authenticated and encrypted, Channel and would only be made available to the parties that strictly require them.</p><p>In the future, the Off-Chain Protocol may be further extended to include functionality such as batching of transactions and additional payments functionality.</p><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="specification"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#specification" title="Direct link to heading">#</a>Specification</h1><hr><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="off-chain-protocol-design-principles"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#off-chain-protocol-design-principles" title="Direct link to heading">#</a>Off-Chain Protocol Design Principles</h1><p><strong>Scalability</strong>. Pursuant to the design of the initial version of the Off-Chain Protocol, all off-chain PaymentObjects that are ready for settlement, would be settled individually (gross) through a separate Blockchain transaction. However, the architecture of the Off-Chain Protocol allows in the future the introduction of netting batches of transactions and settling all of them through a single Blockchain transaction. This allows costs associated with multiple on-chain transactions to be kept low for VASPs, and allows for a number of user transactions or payment between VASPs that exceed the capacity of the underlying Blockchain. Additionally, batches enhance privacy via grouping together the number of transactions between VASPs and by only placing a single on-chain transaction which hides the individual transaction amounts. </p><blockquote><p>Note that every transaction within a batch would first be agreed upon between the VASPs involved, and the VASPs would have full insight into the transactions and any travel rule information about those transactions.</p></blockquote><p><strong>Extensibility</strong>. This initial version of the Off-Chain Protocol accommodates simple payments where a customer of a VASP sends funds to the customer of another VASP over a limit, requiring some additional compliance-related information. However, in the future the blockchains may support more complex flows of funds between customers of VASPs as well as merchants. The Off-Chain Protocol can be augmented to support the transfer of rich meta-data relating to those flows between VASPs in a compliant, secure, private, scalable and extensible manner.</p><p><strong>Generic Communication Framework</strong>. The Off-Chain Protocol is designed as a generic communication framework which can be utilized by any Blockchain and requires no ties to any specific blockchain. While the first potential usage of the Off-Chain Protocol is presented as within the Libra Blockchain, the Off-Chain Protocol makes few and well defined assumptions about the underlying Blockchain environment, which can be fulfilled by other Blockchains. The Off-Chain Protocol can therefore be re-purposed to support compliance, privacy and scalability use-cases between VASPs in other Blockchains, as well as in multiple blockchains simultaneously.</p><p>We describe a number of additional lower-level requirements throughout the remaining of the documents, such as ease of deployment through the use of established web technologies (like HTTP and JSON), tolerance to delays and crash-recovery failures of either VASPs, and compatibility with common cryptography and serialization schemes.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="terminology"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#terminology" title="Direct link to heading">#</a>Terminology</h1><p><strong>Object</strong>: Equivalent to a record in a database.  A payment is an example of an Object.</p><p><strong>Command</strong>: An instruction sent over a Channel to mutate/create one or more Objects.  In the case of a mutation, this Command will depend upon the current value of one of more existing Shared Objects.</p><p><strong>Channel</strong>: The communication path between a pair of entities who execute Commands and track the evolution of a set of Shared Objects.</p><p><strong>Shared Object</strong>: All Objects contained within a Command - for example <code>PaymentObject</code>s, are considered as &quot;Shared Objects&quot; - meaning that either VASP may create a new Command to modify the Object, and will do so during the typical life-cycle of an Object - an example being the addition of required data within the KycDataObject from both VASPs to a payment Object. Both VASPs in a Channel can asynchronously attempt to initiate and execute Commands on Shared Objects.</p><p><strong>Version</strong>: The state of an Object at a specific point in time.  Every creation or mutation creates a new Version of the Object which was created/mutated.  VASPs operate upon the latest Version of Shared Objects.  Once a Version is mutated, it is no longer a valid Version upon which a new Command may depend - the newly updated value of the Version is the latest Version for that Object and must be acted upon.</p><p><strong>reference_id</strong>: Every Object type contains a <code>reference_id</code> field which is a unique reference ID for the Object.  The reference ID is used as a unique identifier of the Object. The reference ID is always specified by the payment initiator VASP (the VASP which originally created the Object). This value should be unique, and formatted as “&lt;creator<em>vasp_onchain_address_bech32&gt;</em>&lt;unique_id&gt;”. For example, ”lbr1x23456abcd_seqABCD“. As an example, see the reference_id field on the <a href="#paymentobject">PaymentObject</a>. Unicode utf-8 encoded.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="overall-off-chain-properties"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#overall-off-chain-properties" title="Direct link to heading">#</a>Overall Off-Chain Properties</h1><p>The Off-Chain Protocol formulates methodologies to provide the following high-level properties:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="channel-establishment"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#channel-establishment" title="Direct link to heading">#</a>Channel Establishment</h3><p>The Off-Chain Protocol allows two entities A and B to form a communication Channel for manipulating a consistent database of Objects and agreeing on Commands that manipulate those Objects.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="command-issuance-by-either-party"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#command-issuance-by-either-party" title="Direct link to heading">#</a>Command Issuance By Either Party</h3><p>Both ends of the Channel can issue Commands upon Shared Objects.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="object-versioning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#object-versioning" title="Direct link to heading">#</a>Object Versioning</h3><p>To ensure a consistent view of Object states, every Object is versioned. Mutations may only occur upon the latest Version of an Object.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="concurrency-control"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#concurrency-control" title="Direct link to heading">#</a>Concurrency Control</h3><p>The Off-Chain Protocol manages concurrent requests on Objects and ensures that Object states will not become out of sync.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="eventual-consistency"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#eventual-consistency" title="Direct link to heading">#</a>Eventual Consistency</h3><p>The Off-Chain Protocol ensures eventual consistency of Shared Objects.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="basic-off-chain-building-blocks"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-off-chain-building-blocks" title="Direct link to heading">#</a>Basic Off-Chain Building Blocks</h1><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="on-chain-account-setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#on-chain-account-setup" title="Direct link to heading">#</a>On-Chain Account Setup</h3><p>A VASP&#x27;s on-chain account must be created and set up in accordance with the standard VASP account creation process.</p><p>Of particular note for off-chain APIs is the compliance key value.  This is the Ed25519 key with which a VASP signs travel rule statements on-chain and the required information within the KycDataObject exchanged via the Off-Chain Protocol.  During account creation, a VASP will set their compliance key which will be stored under the primary VASP account.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="http-end-point"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#http-end-point" title="Direct link to heading">#</a>HTTP end-point</h3><p>Each VASP exposes an HTTPS POST end point at <code>https://&lt;hostname&gt;:&lt;port&gt;/&lt;protocol_version&gt;/&lt;LocalVASPAddress&gt;/&lt;RemoteVASPAddress&gt;/command</code>.</p><ul><li><code>protocol_version</code> is initially 0 for this iteration of the off-chain APIs.</li><li><code>LocalVASPAddress</code> and <code>RemoteVASPAddress</code> are the bech32 VASP addresses of the respective VASPs - with the subaddress set to 0&#x27;s as per <a href="https://lip.libra.org/lip-5/">LIP 5</a>.<ul><li>An example URL: <a href="http://127.0.0.1:7091/v1/lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m/lbr1pgfpyysjzgfpyysjzgfpyysjzggqqqqqqqqqqqqqxjt54z/command/">http://127.0.0.1:7091/v1/lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m/lbr1pgfpyysjzgfpyysjzgfpyysjzggqqqqqqqqqqqqqxjt54z/command/</a></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="http-headers"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#http-headers" title="Direct link to heading">#</a>HTTP Headers</h3><p>All HTTP requests and responses must contain a header <code>X-Request-ID</code> with a unique ID for the request, used for tracking requests and debugging. Responses must have the same string in the <code>X-Request-ID</code> header value as the requests they correspond to.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="payloads"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#payloads" title="Direct link to heading">#</a>Payloads</h3><p>The exposed endpoint receives <code>CommandRequestObject</code>s in the POST body, and responds with <code>CommandResponseObject</code>s in the HTTP response (See <a href="#requestresponse-payload">Request/Response Payload</a> for more details. Single Command requests-responses are supported (HTTP1.0) but also pipelined request-responses are supported (HTTP1.1). The content type of the HTTP request/response is ignored. The version for the Off-Chain Protocol is the string <code>v1</code>.  All structures transmitted, nested within <code>CommandRequestObject</code> and <code>CommandResponseObject</code> are valid JSON serialized Objects and can be parsed and serialized using standard JSON libraries.</p><p>All transmitted requests/responses are signed by the sending party using the JWS Signature standard (with the Ed25519 / EdDSA ciphersuite, and <code>compact</code> encoding).  The party&#x27;s on-chain compliance key shall be used to sign these messages. This ensures all information and meta-data about payments is authenticated and cannot be repudiated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="basic-protocol-interaction"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-protocol-interaction" title="Direct link to heading">#</a>Basic Protocol Interaction</h2><p>Assume two VASPs A and B.  The basic protocol interaction consists of:</p><ul><li>An initiating VASP A creates a <code>CommandRequestObject</code> containing a Command of the desired type.  Commands inform the other VASP what to create or mutate.  Every Command includes one or more Objects to create or update.  For each of those Objects, the Version of that Object is updated by the Command and the old Version becomes obsolete once the Command is applied successfully.</li><li>VASP A packages the Command via JWS using EdDSA and compact encoding.</li><li>VASP A establishes a connection to VASP B and sends the packaged Command to VASP B in the body of an HTTP POST.</li><li>VASP B listens for requests, and when received, verifies VASP A&#x27;s signature and then processes the request to generate and send <code>CommandResponseObject</code> responses, with a success or failure status, through the HTTP response body. In case of an error that prevents VASP B from parsing an incoming <code>CommandRequestObject</code> an HTTP error code is returned.</li><li>The initiating VASP A receives the response, verifies its signature, and processes it to assess whether it was successful or not.</li></ul><p>If VASP A fails to receive a response from VASP B, or in the case of specific protocol failure codes, it must re-send the request at some cadence until a response is received to ensure eventual consistency.</p><p>Commands may flow in both directions - VASP A to VASP B or VASP B to VASP A - and may happen simultaneously in an asynchronous manner, providing <a href="#multi-party-command-issuance">Multi-Party Command Issuance</a>.  By only allowing Commands to build upon the latest agreed-upon Version of an Object, concurrent requests are possible with minimal contention - contention only occurs if simultaneous Commands operate upon the same Object(s) and contention in that case is resolved by nature of <a href="#protocol-server-and-client-roles">Client/Server Roles</a>.</p><img alt="Command Exchange" src="/img/command_exchange.png"><img alt="Command State Flow" src="/img/command_state_flow.png"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="command-sequencing"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#command-sequencing" title="Direct link to heading">#</a>Command Sequencing</h1><p>The low-level Off-Chain Protocol allows two VASPs to sequence request-responses for Commands originating from either VASP, in order to maintain a consistent database of Shared Objects. Sequencing a Command requires both VASPs to confirm it is valid, as well as its sequence in relation to other Commands operating upon the same Objects.  Since Commands may operate upon multiple Objects, a Command only succeeds if the Command is able to be applied to every dependent Object - ensuring atomicity of the Command and consistency of the Objects, providing for <a href="#concurrency-control">Concurrency Control</a>. Both VASPs in a Channel can asynchronously attempt to initiate and execute Commands on Shared Objects. All Commands upon Shared Objects which are exchanged between pairs of VASPs are sequenced relative to the prior state of each Shared Object in the Command. For example, a Command might depend on Object X having Version Y. If there has been a concurrent update to Object X and it has Version Z at the time the Command is processed, the Command will be rejected.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="command-sequencing-object-versioning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#command-sequencing-object-versioning" title="Direct link to heading">#</a>Command Sequencing: Object Versioning</h2><p>To ensure a consistent view of Object states, every Object is <a href="#object-versioning">Versioned</a>. A Command can create or modify one or more Objects. Mutations may only occur upon the latest Version of an Object. When either VASP creates a request, they must denote which Objects are read and which are written during this Command. These are specified in the <code>_reads</code> and <code>_writes</code> fields of the Command.</p><p>As mentioned in <a href="#terminology">Terminology</a>, every Object type contains a <code>reference_id</code> field which is a unique reference ID for the Object.  The <code>_reads</code> field is specified as a JSON mapping of Object <code>&quot;reference_id&quot;</code>: <code>&quot;cid&quot;</code>, where <code>cid</code> (Command ID) is a random 16 byte string encoded in hex. The <code>_writes</code> field represents the new mapping of Objects to a new <code>cid</code> value. The new <code>cid</code> value for an Object created or mutated by a Command is the <code>cid</code> of the Request containing the Command that created or mutated this Object.</p><p>By specifying which Object Versions are read, the off-chain API maintains relative ordering of Commands on Objects and ensures a consistent view of the current state of Objects between parties.  Each Object Version may only be mutated a single time, when a Command succeeds. Once it has been mutated, a new Version is created to represent the latest state of the Object, the old Version can be garbage-collected. This results in what is essentially a per-object sequencing.</p><p>Both <code>_reads</code> and <code>_writes</code> must be exact - meaning that if unused dependencies are specified or insufficient dependencies are specified, the Command will be rejected.</p><p>Sample generation of the <code>cid</code> can be done with something similar to (in <code>python3</code> syntax):</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">urandom(16).hex()</span></div></div></div></div></div></div><img alt="Object Versioning" src="/img/object_versioning.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="protocol-server-and-client-roles"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#protocol-server-and-client-roles" title="Direct link to heading">#</a>Protocol Server and Client Roles</h2><p>In each Channel, one VASP takes the role of a <em>protocol server</em> and the other the role of a <em>protocol client</em> for the purposes of simplifying Shared Object locking / state management. Note that these roles are distinct to the HTTP client/server -- and both VASPs act as an HTTP server and client to listen and respond to requests. To avoid excessive locking and intermediate state management during API requests, by convention the <em>server</em> acts as the source of truth for the state of an Object.  In practice, this means that in the case of lock contention on a Shared Object, the <em>server</em> Command is prioritized.</p><img alt="Object Contention" src="/img/object_contention.png"><p>The protocol server/client role is determined by comparing their binary on-chain Address strings (we call those the <em>binary address</em>. The following rules are used to determine which entity serves as which party: The last bit of VASP A’s parent binary address <em>w</em> (where <code>w = addr[15] &amp; 0x1</code>) is XOR’d with the last bit in VASP B’s parent binary address <em>x</em>.  This results in either 0 or 1. (Refer to <a href="https://github.com/libra/libra/tree/master/client/libra-dev#vasp-account-roles">https://github.com/libra/libra/tree/master/client/libra-dev#vasp-account-roles</a> for additional information on parent/child VASP accounts).
If the result is 0, the lexicographically lower parent address is used as the server side.
If the result is 1, the lexicographically higher parent address is used as the server side. Lexicographic ordering determines which binary address is higher by comparing byte positions one by one, and returning the address with the first higher byte.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="network-error-handling"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#network-error-handling" title="Direct link to heading">#</a>Network Error Handling</h1><p>In the case of network failure, the sending party for this Command is required to re-send the Command until it gets a response from the counterparty VASP.  An exponential backoff is suggested for Command re-sends.  This retransmission strategy allows the Off-Chain Protocol to achieve <a href="#eventual-consistency">eventual consistency</a> of the Shared Objects.  Retransmission must be done regardless of the role of the VASP (protocol client or protocol server).</p><p>Upon receipt of a Command that has already been processed (resulting in a success response or a Command error), the receiving side must reply with the same response as was previously issued. Requests that resulted in protocol errors (such as <code>wait</code>) may result in different responses. For example if VASP A sends a Requests to VASP B, and VASP B responds with a <code>wait</code> protocol error, later VASP A may re-send the same request, and VASP B may respond with a <code>success</code> or a different error.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="requestresponse-payload"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#requestresponse-payload" title="Direct link to heading">#</a>Request/Response Payload</h1><p>All requests between VASPs are structured as <a href="#commandrequestobject"><code>CommandRequestObject</code>s</a> and all responses are structured as <a href="#commandresponseobject"><code>CommandResponseObject</code>s</a>.  The resulting request takes a form of the following (prior to JWS):</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandRequestObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command_type&quot;: &quot;PaymentCommand&quot;, // Command type</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: CommandObject(), // Object of type as specified by command_type</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;cid&quot;: &quot;12ce83f66d180d6e08b6c00fdbbf085a&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><p>A response would look like the following:</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandResponseObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;cid&quot;: &quot;12ce83f66d180d6e08b6c00fdbbf085a&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="commandrequestobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#commandrequestobject" title="Direct link to heading">#</a>CommandRequestObject</h3><p>All requests between VASPs are structured as <code>CommandRequestObject</code>s.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>_ObjectType</td><td>str</td><td>Y</td><td>Fixed value: <code>CommandRequestObject</code></td></tr><tr><td>command_type</td><td>str</td><td>Y</td><td>A string representing the type of Command contained in the request.</td></tr><tr><td>command</td><td>Command object</td><td>Y</td><td>The Command to sequence.</td></tr><tr><td>cid</td><td>str</td><td>Y</td><td>A unique identifier for the Command.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandRequestObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command_type&quot;: CommandType,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: CommandObject(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;cid&quot;: str,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="commandresponseobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#commandresponseobject" title="Direct link to heading">#</a>CommandResponseObject</h3><p>All responses to a CommandRequestObject are in the form of a CommandResponseObject</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>_ObjectType</td><td>str</td><td>Y</td><td>The fixed string <code>CommandResponseObject</code>.</td></tr><tr><td>status</td><td>str</td><td>Y</td><td>Either <code>success</code> or <code>failure</code>.</td></tr><tr><td>error</td><td>List of <a href="#offchainerrorobject">OffChainErrorObject</a></td><td>N</td><td>Details on errors when status == &quot;failure&quot;</td></tr><tr><td>cid</td><td>str</td><td>N</td><td>The Command identifier to which this is a response.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandResponseObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;error&quot;: [OffChainErrorObject()],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;failure&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;cid&quot;: str,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><p>When the <code>CommandResponseObject</code> status field is <code>failure</code>, the <code>error</code> field is included in the response to indicate the nature of the failure. The <code>error</code> field (type <code>OffChainError</code>) is a list of OffChainError objects. In case of failure to recover the request (such as a parsing failure or a signature failure) <code>cid</code> may be omitted.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="offchainerrorobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#offchainerrorobject" title="Direct link to heading">#</a>OffChainErrorObject</h3><p>Represents an error that occurred in response to a Command.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>type</td><td>str (enum)</td><td>Y</td><td>Either &quot;command_error&quot; or &quot;protocol_error&quot;</td></tr><tr><td>field</td><td>str</td><td>N</td><td>The field on which this error occurred</td></tr><tr><td>code</td><td>str (enum)</td><td>Y</td><td>The error code of the corresponding error</td></tr><tr><td>message</td><td>str</td><td>N</td><td>Additional details about this error</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;command_error&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;field&quot;: &quot;0.sender.kyc_data.surname&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;code&quot;: &quot;missing_data&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;message&quot;: &quot;&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><p>&#x27;command_error&#x27; occurs in response to a Command failing to be applied - for example, invalid <code>_reads</code> values, or high level validation errors.  <code>protocol_error</code> occurs in response to a failure related to the lower-level protocol.  Note: Additional information detailing all errors will be added.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="travel-rule-data-exchange"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#travel-rule-data-exchange" title="Direct link to heading">#</a>Travel Rule Data Exchange</h1><p>In the initial version of the off-chain APIs, the usage is intended as a means of transferring travel-rule information between VASPs.  The following will detail the request and response payloads utilized for this purpose.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="requestresponse-payload-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#requestresponse-payload-1" title="Direct link to heading">#</a>Request/Response Payload</h2><p>All requests between VASPs are structured as <a href="#commandrequestobject"><code>CommandRequestObject</code>s</a> and all responses are structured as <a href="#commandresponseobject"><code>CommandResponseObject</code>s</a>.  For a travel-rule data exchange, the resulting request takes a form of the following:</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandRequestObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command_type&quot;: &quot;PaymentCommand&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;cid&quot;: &quot;88b282d6181129f682be0421d0ee9887&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;_ObjectType&quot;: &quot;PaymentCommand&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;_reads&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_5b8403c986f53fe072301fe950d030cb&quot;: &quot;fd52e9c2a7ccc96be564d67199774fbc&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;_writes&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_5b8403c986f53fe072301fe950d030cb&quot;: &quot;88b282d6181129f682be0421d0ee9887&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;payment&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;sender&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;address&quot;: &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pg9skzctpv9skzcg9kmwta&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;kyc_data&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;payload_type&quot;: &quot;KYC_DATA&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;payload_version&quot;: 1,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;type&quot;: &quot;individual&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;given_name&quot;: &quot;ben&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;surname&quot;: &quot;maurer&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;address&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;city&quot;: &quot;Sunnyvale&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;country&quot;: &quot;US&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;line1&quot;: &quot;1234 Maple Street&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;line2&quot;: &quot;Apartment 123&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;postal_code&quot;: &quot;12345&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;state&quot;: &quot;California&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;dob&quot;: &quot;1920-03-20&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;place_of_birth&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;city&quot;: &quot;Sunnyvale&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;country&quot;: &quot;US&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;postal_code&quot;: &quot;12345&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;state&quot;: &quot;California&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    &quot;status&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        &quot;status&quot;: &quot;ready_for_settlement&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;receiver&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;address&quot;: &quot;lbr1pgfpyysjzgfpyysjzgfpyysjzgf3xycnzvf3xycsm957ne&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;reference_id&quot;: &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_5b8403c986f53fe072301fe950d030cb&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;action&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;amount&quot;: 100,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;currency&quot;: &quot;USD&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;action&quot;: &quot;charge&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;timestamp&quot;: 72322,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;description&quot;: &quot;A free form or structured description of the payment.&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><p>A response would look like the following:</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;CommandResponseObject&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;success&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="commandrequestobject-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#commandrequestobject-1" title="Direct link to heading">#</a>CommandRequestObject</h3><p>For a travel rule data exchange, the <a href="#commandrequestobject">command_type</a> field is set to &quot;PaymentCommand&quot;.  The Command Object is a <a href="#paymentcommand-object"><code>PaymentCommand</code> Object</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="paymentcommand-object"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#paymentcommand-object" title="Direct link to heading">#</a>PaymentCommand Object</h3><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>_ObjectType</td><td>str</td><td>Y</td><td>The fixed string <code>PaymentCommand</code></td></tr><tr><td>payment</td><td><a href="#paymentobject"><code>PaymentObject</code></a></td><td>Y</td><td>contains a <code>PaymentObject</code> that either creates a new payment or updates an existing payment. Note that strict validity check apply when updating payments, that are listed in the section below describing these Objects. An invalid update or initial payment Object results in a Command error</td></tr><tr><td>_reads</td><td>JSON Object map</td><td>Y</td><td>Must be an Object containing mappings of <code>reference_id</code> to latest Version as represented by the <code>cid</code> of the latest Command which successfully mutated the Object referenced by the <code>reference_id</code>. The value in this field must match a <code>cid</code> previously specified by a Command by the <code>_writes</code> parameter on a prior Command for this payment Object.  For a payment Command, only zero or one <code>_reads</code> values should be specified since payments are only dependent upon at most prior Version of an Object. A list with any other number of items results in a Command error.  If the list is empty this payment Command defines a new payment. If the list contains one item, then this Command updates the shared <code>PaymentObject</code>.</td></tr><tr><td>_writes</td><td>JSON object map</td><td>Y</td><td>For a payment Command, the <code>_writes</code> field may only be a single key-value pair since a payment Command only operates upon one Object.  This field maps the <code>reference_id</code> of the Object being written to its new Version.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_ObjectType&quot;: &quot;PaymentCommand&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_reads&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_d4115900aad65d8141236b464f1315f5&quot;: &quot;35713c723c4d2516c515aa34b3ba9232&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;_writes&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_d4115900aad65d8141236b464f1315f5&quot;: &quot;12ce83f66d180d6e08b6c00fdbbf085a&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;payment&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        PaymentObject(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="paymentobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#paymentobject" title="Direct link to heading">#</a>PaymentObject</h3><p>The structure in this Object can be a full payment or just the fields of an existing payment Object that need to be changed. Some fields are immutable after they are defined once (see below). Others can by updated multiple times. Updating immutable fields with a different value results in a Command error, but it is acceptable to re-send the same value.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>sender/receiver</td><td><a href="#paymentactorobject"><code>PaymentActorObject</code></a></td><td>Required for payment creation</td><td>Information about the sender/receiver in this payment</td></tr><tr><td>reference_id</td><td>str</td><td>Y</td><td>Unique reference ID of this payment on the payment initiator VASP (the VASP which originally created this payment Object). This value should be unique, and formatted as “&lt;creator<em>vasp_onchain_address_bech32&gt;</em>&lt;unique_id&gt;”.  For example, ”lbr1x23456abcd_seqABCD“. This field is mandatory on payment creation and immutable after that.</td></tr><tr><td>original_payment_reference_id</td><td>str</td><td>N</td><td>Used for updates to a payment after it has been committed on chain. For example, used for refunds. The reference ID of the original payment will be placed into this field. This value is optional on payment creation and invalid on updates.</td></tr><tr><td>recipient_signature</td><td>str</td><td>N</td><td>Signature of the recipient of this transaction. The is signed with the compliance key of the recipient VASP and is used for on-chain attestation from the recipient party.  This may be omitted on blockchains which do not require on-chain attestation. Generated via <a href="#recipient-signature">Recipient Signature</a></td></tr><tr><td>action</td><td><a href="#paymentactionobject"><code>PaymentActionObject</code></a></td><td>Y</td><td>Number of cryptocurrency + currency type (LBR, etc.)<a href="#note1" id="note1ref"><sup>1</sup></a> + type of action to take. This field is mandatory and immutable</td></tr><tr><td>description</td><td>str</td><td>N</td><td>Description of the payment. To be displayed to the user. Unicode utf-8 encoded max length of 255 characters. This field is optional but can only be written once.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;sender&quot;: payment_actor_object(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;receiver&quot;: payment_actor_object(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;reference_id&quot;: &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_d4115900aad65d8141236b464f1315f5&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;original_payment_reference_id&quot;: &quot;lbr1pg9q5zs2pg9q5zs2pg9q5zs2pgyqqqqqqqqqqqqqqspa3m_5b8403c986f53fe072301fe950d030cb&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;recipient_signature&quot;: &quot;...&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;action&quot;: payment_action_object(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;description&quot;: &quot;A free form or structured description of the payment.&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="paymentactorobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#paymentactorobject" title="Direct link to heading">#</a>PaymentActorObject</h3><p>A <code>PaymentActorObject</code> represents a participant in a payment - either sender or receiver. It also includes the status of the actor, indicates missing information or willingness to settle or abort the payment, and the Know-Your-Customer information of the customer involved in the payment.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>address</td><td>str</td><td>Y</td><td>Address of the sender/receiver account. Addresses may be single use or valid for a limited time, and therefore VASPs should not rely on them remaining stable across time or different VASP addresses. The addresses are encoded using bech32. The bech32 address encodes both the address of the VASP as well as the specific user&#x27;s subaddress. They should be no longer than 80 characters. Mandatory and immutable. For Libra addresses, refer to &quot;account identifier&quot; section in LIP-5 for format.</td></tr><tr><td>kyc_data</td><td><a href="#kycdataobject">KycDataObject</a></td><td>N</td><td>The KYC data for this account. This field is optional but immutable once it is set.</td></tr><tr><td>status</td><td><a href="#statusobject">StatusObject</a></td><td>Y</td><td>Status of the payment from the perspective of this actor. This field can only be set by the respective sender/receiver VASP and represents the status on the sender/receiver VASP side. This field is mandatory by this respective actor (either sender or receiver side) and mutable.</td></tr><tr><td>metadata</td><td>list of str</td><td>Y</td><td>Can be specified by the respective VASP to hold metadata that the sender/receiver VASP wishes to associate with this payment. This is a mandatory field but can be set to an empty list (i.e. <code>[]</code>). New string-typed entries can be appended at the end of the list, but not deleted.</td></tr><tr><td>metadata</td><td>list of str</td><td>Y</td><td>Can be specified by the respective VASP to hold metadata that the sender/receiver VASP wishes to associate with this payment. This is a mandatory field but can be set to an empty list (i.e. <code>[]</code>). New string-typed entries can be appended at the end of the list, but not deleted.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: &quot;lbr1pgfpyysjzgfpyysjzgfpyysjzgf3xycnzvf3xycsm957ne&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;kyc_data&quot;: kyc_data_object(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: status_object(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;metadata&quot;: [],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="kycdataobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#kycdataobject" title="Direct link to heading">#</a>KYCDataObject</h3><p>A <code>KYCDataObject</code> represents the required information for a single subaddress.  Proof of non-repudiation is provided by the signatures included in the JWS payloads.  The only mandatory fields are <code>payload_type</code>, <code>payload_version</code> and <code>type</code>. All other fields are optional from the point of view of the protocol -- however they may need to be included for another VASP to be ready to settle the payment.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>payload_type</td><td>str</td><td>Y</td><td>Used to help determine what type of data this will deserialize into.  Always set to KYC_DATA.</td></tr><tr><td>payload_version</td><td>str</td><td>Y</td><td>Version identifier to allow modifications to KYC data Object without needing to bump version of entire API set.  Set to 1</td></tr><tr><td>type</td><td>str</td><td>Y</td><td>Required field, must be either “individual” or “entity”</td></tr><tr><td>given_name</td><td>str</td><td>N</td><td>Legal given name of the user for which this KYC data Object applies.</td></tr><tr><td>surname</td><td>str</td><td>N</td><td>Legal surname of the user for which this KYC data Object applies.</td></tr><tr><td>address</td><td><a href="#addressobject">AddressObject</a></td><td>N</td><td>Physical address data for this account</td></tr><tr><td>dob</td><td>str</td><td>N</td><td>Date of birth for the holder of this account.  Specified as an ISO 8601 calendar date format: <a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></td></tr><tr><td>place_of_birth</td><td><a href="#addressobject">AddressObject</a></td><td>N</td><td>Place of birth for this user.  line1 and line2 fields should not be populated for this usage of the address Object</td></tr><tr><td>national_id</td><td><a href="#nationalidobject">NationalIdObject</a></td><td>N</td><td>National ID information for the holder of this account</td></tr><tr><td>legal_entity_name</td><td>str</td><td>N</td><td>Name of the legal entity.  Used when subaddress represents a legal entity rather than an individual. KYCDataObject should only include one of legal_entity_name OR given_name/surname</td></tr><tr><td>additional_kyc_data</td><td>str</td><td>N</td><td>Freeform KYC data.  If a soft-match occurs, this field should be used to specify additional KYC data which can be used to clear the soft-match.  It is suggested that this data be JSON, XML, or another human-readable form.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;payload_type&quot;: &quot;KYC_DATA&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;payload_version&quot;: 1,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;individual&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;given_name&quot;: &quot;ben&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;surname&quot;: &quot;maurer&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        AddressObject(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;dob&quot;: &quot;1920-03-20&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;place_of_birth&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        AddressObject(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;national_id&quot;: {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    },</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="addressobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#addressobject" title="Direct link to heading">#</a>AddressObject</h3><p>Represents a physical address</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>city</td><td>str</td><td>N</td><td>The city, district, suburb, town, or village</td></tr><tr><td>country</td><td>str</td><td>N</td><td>Two-letter country code (<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2</a>)</td></tr><tr><td>line1</td><td>str</td><td>N</td><td>Address line 1</td></tr><tr><td>line2</td><td>str</td><td>N</td><td>Address line 2 - apartment, unit, etc.</td></tr><tr><td>postal_code</td><td>str</td><td>N</td><td>ZIP or postal code</td></tr><tr><td>state</td><td>str</td><td>N</td><td>State, county, province, region.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;city&quot;: &quot;Sunnyvale&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;country&quot;: &quot;US&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;line1&quot;: &quot;1234 Maple Street&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;line2&quot;: &quot;Apartment 123&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;postal_code&quot;: &quot;12345&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;state&quot;: &quot;California&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="nationalidobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#nationalidobject" title="Direct link to heading">#</a>NationalIdObject</h3><p>Represents a national ID.</p><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>id_value</td><td>str</td><td>Y</td><td>Indicates the national ID value - for example, a social security number</td></tr><tr><td>country</td><td>str</td><td>N</td><td>Two-letter country code (<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2</a>)</td></tr><tr><td>type</td><td>str</td><td>N</td><td>Indicates the type of the ID</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;id_value&quot;: &quot;123-45-6789&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;country&quot;: &quot;US&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;SSN&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="paymentactionobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#paymentactionobject" title="Direct link to heading">#</a>PaymentActionObject</h3><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>amount</td><td>uint</td><td>Y</td><td>Amount of the transfer.  Base units are the same as for on-chain transactions for this currency.  For example, if LibraUSD is represented on-chain where “1” equals 1e-6 dollars, then “1” equals the same amount here.  For any currency, the on-chain mapping must be used for amounts.</td></tr><tr><td>currency</td><td>enum</td><td>Y</td><td>One of the supported on-chain currency types - ex. LBR, etc. <a href="#note1" id="note1ref"><sup>1</sup></a></td></tr><tr><td>action</td><td>enum</td><td>Y</td><td>Populated in the request.  This value indicates the requested action to perform, and the only valid value is <code>charge</code>.</td></tr><tr><td>timestamp</td><td>uint</td><td>Y</td><td>Unix timestamp indicating the time that the payment Command was created.</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;amount&quot;: 100,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;currency&quot;: &quot;USD&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;action&quot;: &quot;charge&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;timestamp&quot;: 72322,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="statusobject"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#statusobject" title="Direct link to heading">#</a>StatusObject</h3><table><thead><tr><th>Field</th><th>Type</th><th>Required?</th><th>Description</th></tr></thead><tbody><tr><td>status</td><td>str enum</td><td>Y</td><td>Status of the payment from the perspective of this actor. This field can only be set by the respective sender/receiver VASP and represents the status on the sender/receiver VASP side. This field is mandatory by this respective actor (either sender or receiver side) and mutable. Valid values are specified in <a href="#statusenum"> StatusEnum </a></td></tr><tr><td>abort_code</td><td>str (enum)</td><td>N</td><td>In the case of an <code>abort</code> status, this field may be used to describe the reason for the abort. Represents the error code of the corresponding error</td></tr><tr><td>abort_message</td><td>str</td><td>N</td><td>Additional details about this error.  To be used only when <code>code</code> is populated</td></tr></tbody></table><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: &quot;needs_kyc_data&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="statusenum"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#statusenum" title="Direct link to heading">#</a>StatusEnum</h3><p>Valid values are:</p><ul><li><code>none</code> - No status is yet set from this actor.</li><li><code>needs_kyc_data</code> - KYC data about the subaddresses is required by this actor.</li><li><code>needs_recipient_signature</code> - Can only be associated with the sender actor.  Means that the sender still requires that the recipient VASP provide the signature so that the transaction can be put on-chain.</li><li><code>ready_for_settlement</code> - Transaction is ready for settlement according to this actor (i.e. the required signatures/KYC data have been provided)</li><li><code>settled</code> - Payment has been settled on chain and funds delivered to the subaddress</li><li><code>abort</code> - Indicates the actor wishes to abort this payment, instead of settling it.</li><li><code>pending_review</code> - Payment is pending review.</li><li><code>soft_match</code> - Actor&#x27;s KYC data resulted in a soft-match. The VASP associated with this actor will need to determine what next steps are required, and if it decides to send additional KYC information to clear the soft-match does so via the KYCObject field of additional_kyc_data. If not sent within SLA window, this transaction will be aborted.</li></ul><p><strong>Valid Status Transitions</strong>. Each side of the transaction is only allowed to mutate their own status (sender or receiver), and upon payment creation may only set the status of the other party to <code>none</code>. Subsequently, each party may only modify their own status to a higher or equal status in the order <code>none</code>, (<code>needs_kyc_data</code>, <code>needs_recipient_signature</code>, <code>pending_review</code>, <code>soft_match</code>), (<code>ready_for_settlement</code>, <code>abort</code>).</p><p>A status of <code>abort</code> on <em>either</em> side is terminal and the payment must not be changed subsequently.
A status of <code>ready_for_settlement</code> on <em>both</em> sides is also terminal, and indicates that the payment should be settled on-chain and not modified further. It is therefore safe for a VASP sending funds to initiate an On-Chain payment to settle an Off-chain payment after it observed the other party setting their status to <code>ready_for_settlement</code> and it is also willing to go past this state.</p><p>A state of <code>pending_review</code> may be set to indicate a manual review is taking place. This status is informational and the other VASP is not expected to take any action. The <code>pending_review</code> status may result in any of <code>soft_match</code>, <code>ready_for_settlement</code>, or <code>abort</code>.</p><p>In the event of a soft match, the VASP associated with this actor will need to determine what next steps are required, and if it decides to send additional KYC information to clear the soft-match does so via the KYCObject field of additional_kyc_data. After human review of this data, this state may result in any of ready_for_settlement or abort (abort if the soft-match was unable to be cleared). If data is not received within a reasonable SLA (suggested to be 24 hours), this state will result in abort. The VASP providing the additional KYC data is also allowed to abort the transaction at any point if they do not have additional KYC data or do not wish to supply it.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recipient-signature"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recipient-signature" title="Direct link to heading">#</a>Recipient Signature</h1><p>Once the recipient side is comfortable that it has received appropriate information and is ready for the transaction to go on-chain, the recipient side will provide their signature in order to support dual attestation. The receiver VASP will sign with the receiver compliance private key. The following is a concrete example of how to generate the Travel Rule dual attestation signable and the recipient signature using Libra Python Client SDK:</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">from pylibra import lcs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">from pylibra import libra_types as libra</span></div><div class="token-line" style="color:#393A34"><span class="token plain">from pylibra import serde_types as st</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">metadata: Metadata = libra.Metadata__TravelRuleMetadata(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  libra.TravelRuleMetadata__TravelRuleMetadataVersion0(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    libra.TravelRuleMetadataV0(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      off_chain_reference_id=&quot;reference_id&quot;,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// `lcs_metadata` will be used as the `metadata` parameter in encode_peer_to_peer_with_metadata_script()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">lcs_metadata = lcs.serialize(metadata, libra.Metadata)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_bytes: bytearray = bytearray()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_bytes.extend(lcs_metadata)  # Travel Rule metadata</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_bytes.extend(lcs.serialize(bytes.fromhex(&quot;793251de1a61e9b4d1a17d13aa015e45&quot;), bytes))  # Raw on-chain address (https://github.com/libra/lip/blob/master/lips/lip-5.md#terminology)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_bytes.extend(lcs.serialize(st.uint64(1000000), st.uint64))  # Amount</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_bytes.extend(lcs.serialize(b&quot;@@$$LIBRA_ATTEST$$@@&quot;, bytes))  # ASCII-encoded Libra Domain Separator string</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg = libra.TransactionArgument__U8Vector(bytes(dual_attest_msg_bytes))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">dual_attest_msg_lcs = lcs.serialize(dual_attest_msg, libra.TransactionArgument__U8Vector)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// We sign the bytes LCS bytes directly with the compliance private key</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// `receiver_metadata_signature` will be used as the `metadata_signature` parameter in  encode_peer_to_peer_with_metadata_script()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">receiver_metadata_signature = compliance_private_key.sign(dual_attest_msg_lcs)</span></div></div></div></div></div></div><p>The <code>receiver_metadata_signature</code> will then be placed into the <code>recipient_signature</code> field of the PaymentObject in the off-chain API, thus providing it to the sender so that the sender VASP may submit the transaction on-chain.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="on-chain-transaction-submission"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#on-chain-transaction-submission" title="Direct link to heading">#</a>On-chain Transaction Submission</h1><p>Once both sender and receiver have a status of &#x27;ready_for_settlement&#x27;, the transaction may then be submitted on-chain by the sender VASP. This submission will utilize the <code>recipient_signature</code> which was provided by the receiver VASP (generated via <a href="#recipient-signature">Recipient Signature</a>.  The sender VASP will now generate a transaction via the following and then submit the transaction on-chain:</p><div class="mdxCodeBlock_iHAB"><div class="snippet-container"><div class="snippet-header"></div><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">use libra_types::transaction::{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    RawTransaction,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    metadata::{Metadata, TravelRuleMetadata, TravelRuleMetadataV0}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">};</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">metadata = Metadata::TravelRuleMetadata(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  TravelRuleMetadata::TravelRuleMetadataVersion0(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    TravelRuleMetadataV0 {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      off_chain_reference_id: &quot;123abc&quot;, /* The off-chain reference ID specified by `reference_id` in the Off-chain APIs */</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}));</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">lcs_metadata = lcs.serialize(metadata, Metadata);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">program = encode_peer_to_peer_with_metadata_script(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;LBR&quot; /*currency*/,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    0x1234 /*recipient*/,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    100 /*amount*/,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lcs_metadata,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    recipient_signature /* from off-chain API exchange */);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">RawTransaction {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    sender_account: 0x7777,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    program: program,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></div><p>For additional details, see <a href="https://lip.libra.org/lip-4/#c-to-c-transaction-flow">https://lip.libra.org/lip-4/#c-to-c-transaction-flow</a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="reference-implementation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#reference-implementation" title="Direct link to heading">#</a>Reference Implementation</h1><p>A reference implementation of the Off-Chain Protocol is located at <a href="https://github.com/libra/off-chain-reference">https://github.com/libra/off-chain-reference</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="disclaimers"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#disclaimers" title="Direct link to heading">#</a>Disclaimers</h1><p>THIS API AND REFERENCE IMPLEMENTATION IS PROVIDED &quot;AS IS&quot; WITH NO EXPRESS OR IMPLIED WARRANTIES WHATSOEVER, INCLUDING ANY WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, COMPLIANCE WITH LAW, ACCURACY, COMPLETENESS, OR NONINFRINGEMENT OF INTELLECTUAL PROPERTY RIGHTS.</p><p>The Libra Association disclaims all liability relating to this API and to the implementation of this API, including the reference implementation, and disclaims all liability for cost of procurement of substitute services, lost profits, loss of use, loss of data or any incidental, consequential, direct,
indirect, or special damages, whether under contract, tort, warranty or otherwise, arising in any way out of use or reliance upon this API, the reference implementation, or any information herein.</p><p>The compliance processes described in this LIP are for informational purposes only and do not reflect the specific compliance obligations of VASPs under applicable regulatory frameworks, their compliance programs, and/or standards imposed by Libra Networks.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="copyright-notice"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#copyright-notice" title="Direct link to heading">#</a>Copyright Notice</h1><p>This documentation is made available under the Creative Commons Attribution 4.0 International (CC BY 4.0) license (available at <a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a>).</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="footnotes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#footnotes" title="Direct link to heading">#</a>Footnotes</h1><a id="note1" href="#note1ref"><sup>1</sup></a>The Off-Chain Protocol is a generic protocol which is available for broader use among any blockchain - meaning currencies such as BTC could also utilize this same protocol if desired.</div><div class="margin-bottom--lg margin-top--xl"><div class="copyright_2KXk">Copyright Notice: This documentation is made available under the Creative Commons Attribution 4.0 International (CC BY 4.0) license (available at<a href="https://creativecommons.org/licenses/by/4.0/" target="blank"> https://creativecommons.org/licenses/by/4.0/</a>).</div></div></article></div></div><div class="root_8Z_c"><div class="root_1i3D"><a class="backgroundIcon_1ksJ" style="background-image:url(&#x27;/img/shared/edit.svg&#x27;)" href="https://github.com/libra/lip/edit/master/lips/lip-1.mdx" target="_blank">Edit</a><label class="toggle_1FtV"><div class="react-toggle react-toggle--disabled"><div class="react-toggle-track"><div class="react-toggle-track-check"></div><div class="react-toggle-track-x"></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><span>Dark Mode</span></label></div><div class="root_1UF_"><span class="title_1uUK">On This Page</span><ul class="category_2Qio"><li class="heading_2ndx"><a href="#header" class="contentsLink_30JX">Off-chain API</a></li><li class="heading_2ndx"><a href="#metadata-table" class="contentsLink_30JX">Meta data</a></li><li class="heading_2ndx"><a href="#channel-establishment" class="contentsLink_30JX">Channel Establishment</a></li><li class="heading_2ndx"><a href="#command-issuance-by-either-party" class="contentsLink_30JX">Command Issuance By Either Party</a></li><li class="heading_2ndx"><a href="#object-versioning" class="contentsLink_30JX">Object Versioning</a></li><li class="heading_2ndx"><a href="#concurrency-control" class="contentsLink_30JX">Concurrency Control</a></li><li class="heading_2ndx"><a href="#eventual-consistency" class="contentsLink_30JX">Eventual Consistency</a></li><li class="heading_2ndx"><a href="#on-chain-account-setup" class="contentsLink_30JX">On-Chain Account Setup</a></li><li class="heading_2ndx"><a href="#http-end-point" class="contentsLink_30JX">HTTP end-point</a></li><li class="heading_2ndx"><a href="#http-headers" class="contentsLink_30JX">HTTP Headers</a></li><li class="heading_2ndx"><a href="#payloads" class="contentsLink_30JX">Payloads</a></li><li class="heading_2ndx"><a href="#basic-protocol-interaction" class="contentsLink_30JX">Basic Protocol Interaction</a></li><li class="heading_2ndx"><a href="#command-sequencing-object-versioning" class="contentsLink_30JX">Command Sequencing: Object Versioning</a></li><li class="heading_2ndx"><a href="#protocol-server-and-client-roles" class="contentsLink_30JX">Protocol Server and Client Roles</a><ul class="category_2Qio"><li class="heading_2ndx"><a href="#commandrequestobject" class="contentsLink_30JX">CommandRequestObject</a></li><li class="heading_2ndx"><a href="#commandresponseobject" class="contentsLink_30JX">CommandResponseObject</a></li><li class="heading_2ndx"><a href="#offchainerrorobject" class="contentsLink_30JX">OffChainErrorObject</a></li></ul></li><li class="heading_2ndx"><a href="#requestresponse-payload-1" class="contentsLink_30JX">Request/Response Payload</a><ul class="category_2Qio"><li class="heading_2ndx"><a href="#commandrequestobject-1" class="contentsLink_30JX">CommandRequestObject</a></li><li class="heading_2ndx"><a href="#paymentcommand-object" class="contentsLink_30JX">PaymentCommand Object</a></li><li class="heading_2ndx"><a href="#paymentobject" class="contentsLink_30JX">PaymentObject</a></li><li class="heading_2ndx"><a href="#paymentactorobject" class="contentsLink_30JX">PaymentActorObject</a></li><li class="heading_2ndx"><a href="#kycdataobject" class="contentsLink_30JX">KYCDataObject</a></li><li class="heading_2ndx"><a href="#addressobject" class="contentsLink_30JX">AddressObject</a></li><li class="heading_2ndx"><a href="#nationalidobject" class="contentsLink_30JX">NationalIdObject</a></li><li class="heading_2ndx"><a href="#paymentactionobject" class="contentsLink_30JX">PaymentActionObject</a></li><li class="heading_2ndx"><a href="#statusobject" class="contentsLink_30JX">StatusObject</a></li><li class="heading_2ndx"><a href="#statusenum" class="contentsLink_30JX">StatusEnum</a></li></ul></li></ul></div></div></div></main></div></div><footer><div class="spacer_1x4Y"><div class="container_1nSa"><div class="logo_5rC0"><a href="https://libra.org/"><svg fill="#42318C" class="logo_svg__Logo" viewBox="0 0 1229.78 330.24" alt="Libra Logo"><path d="M314.82 292.65a192 192 0 0023.31-32.92l-39.45-19.64A120.78 120.78 0 01278 266c-11 10.21-22.7 16.16-34.61 17.68-23 2.94-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.66-65.44 37.39A191.89 191.89 0 000 306.13l39.44 19.64a121.7 121.7 0 0120.64-25.93c10.88-10.07 22.52-16 34.62-17.51a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92l-39.45-19.64A121 121 0 01278 148.53c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.63-15.8-52.54-33.71-92.15-28.65-24 3.08-46.06 15.65-65.44 37.39A191.5 191.5 0 000 188.65l39.44 19.64a122 122 0 0120.64-25.94C71 172.29 82.6 166.4 94.7 164.85a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.66 33.15 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zm0-117.48a192 192 0 0023.31-32.92L298.68 5.13A121 121 0 01278 31.05c-11 10.21-22.7 16.16-34.61 17.68-23 2.93-39.07-4.17-62.51-19.21-24.6-15.8-52.51-33.71-92.12-28.65C64.72 4 42.7 16.52 23.32 38.26A191.5 191.5 0 000 71.17l39.44 19.64a122 122 0 0120.64-25.94C71 54.81 82.6 48.92 94.7 47.37a79.51 79.51 0 0110-.66c18.14 0 32.71 7 52.52 19.71 23 14.77 51.64 33.14 92.17 28 24.48-3.16 46.5-15.51 65.43-36.73zM452.56 5.45v321.16H407V5.45zm48.09 92.44v228.72h45.6V97.89zM929.5 150.7c18.77-12.62 40.86-16.24 63-12.71v-39.8a125.23 125.23 0 00-15.42-1c-31.27 0-56.07 9.56-68 26.22l-5.6 7.78V97.63h-45.64v229h45.37v-79.58c0-14.57-.16-26.82 0-41.39.29-24.04 8.39-42.91 26.29-54.96zm300.28 175.91v-229h-42.41v25.15l-5.1-4.39c-19.87-17.1-43.94-25.77-71.54-25.77-20.55 0-39.9 5-56 14.58-37 21.87-59 61.09-59 104.92s21.88 82.74 58.53 104.42c15.9 9.44 37.38 15.08 57.46 15.08 26.92 0 52-9.14 70.49-25.73l5.15-4.61v25.33zm-60.51-57.25a73.75 73.75 0 01-51.27 23.35c-.92 0-1.82.05-2.71.05-45.5 0-81.14-35.42-81.14-80.64 0-21.28 7.64-41.26 21.52-56.26 14.55-15.72 34.84-24.38 57.12-24.38 1 0 2.1 0 3.16.05a75.59 75.59 0 0152.75 23.78 78.06 78.06 0 0121.52 54v7.44a76.41 76.41 0 01-20.95 52.61zm-455.89 62.26c20.55 0 39.9-5 56-14.58 37-21.87 59-61.09 59-104.92s-21.88-82.74-58.53-104.42c-15.9-9.44-37.39-15.08-57.47-15.08-26.91 0-51.94 9.14-70.49 25.74l-5.15 4.6V5.45h-42.4v321.16h42.4v-25.15l5.11 4.39c19.87 17.15 43.94 25.77 71.53 25.77zM633.94 215v-7.44a76.46 76.46 0 0120.9-52.64 73.78 73.78 0 0151.33-23.35c.91 0 1.81-.05 2.71-.05 45.5 0 81.14 35.42 81.14 80.64 0 21.28-7.65 41.26-21.53 56.26-14.55 15.72-34.83 24.38-57.11 24.38-1 0-2.11 0-3.16-.05a75.61 75.61 0 01-52.76-23.78A78.11 78.11 0 01633.94 215zM546.25 5.45h-45.6V51h45.6z"></path></svg></a></div><ul class="linkList_1rHB primary_3pKl"><li class="primary_3pKl"><a href="https://libra.org/vision/">Vision</a></li><li class="primary_3pKl"><a href="https://libra.org/association/">Association</a></li><li class="primary_3pKl"><a href="https://libra.org/developers/">Developers</a></li><li class="primary_3pKl"><a href="https://libra.org/learn-faqs/">Learn</a></li></ul><ul class="linkList_1rHB primary_3pKl"><li class="primary_3pKl"><a href="https://libra.org/media-press-news/">Media</a></li><li class="primary_3pKl"><a href="https://libra.org/white-paper/">White Paper</a></li><li class="primary_3pKl"><a href="https://libra.org/careers/">Careers</a></li></ul><ul class="linkList_1rHB secondary_17rk"><li class="secondary_17rk"><a href="https://libra.org/privacy/">Privacy</a></li><li class="secondary_17rk"><a href="https://libra.org/privacy/#cookies_policy">Cookies</a></li><li class="secondary_17rk"><a href="https://libra.org/privacy/#terms_of_use">Terms of Use</a></li><li class="secondary_17rk"><a href="https://developers.libra.org/docs/policies/code-of-conduct">Code of Conduct</a></li></ul><div class="connect_19zz"><ul class="root_1DBI"><li><a href="https://twitter.com/libradev"><svg width="22" height="17"><path d="M22 2.006c-.81.341-1.679.571-2.593.675.933-.53 1.648-1.37 1.985-2.37a9.35 9.35 0 01-2.866 1.04 4.623 4.623 0 00-3.294-1.354c-2.493 0-4.514 1.919-4.514 4.284 0 .337.04.664.117.977C7.083 5.08 3.758 3.374 1.532.781A4.103 4.103 0 00.92 2.936c0 1.486.796 2.798 2.007 3.566a4.675 4.675 0 01-2.044-.536v.053c0 2.077 1.555 3.809 3.62 4.202a4.75 4.75 0 01-2.038.074c.574 1.702 2.241 2.94 4.217 2.975a9.367 9.367 0 01-5.606 1.834c-.365 0-.724-.02-1.077-.06a13.272 13.272 0 006.918 1.926c8.303 0 12.843-6.53 12.843-12.191 0-.186-.004-.37-.013-.555A8.922 8.922 0 0022 2.006" fill="#402F8F" fill-rule="evenodd"></path></svg></a></li><li><a href="https://www.facebook.com/LibraAssociation/"><svg width="20" height="20"><defs><path id="facebook_svg__a" d="M0 0h19.997v19.968H0z"></path></defs><g fill="none" fill-rule="evenodd"><mask id="facebook_svg__b" fill="#fff"><use xlink:href="#facebook_svg__a"></use></mask><path d="M17.5 0h-15A2.506 2.506 0 000 2.496v14.976a2.504 2.504 0 002.499 2.495h7.586v-7.16H7.689V9.689h2.396V8.126c0-2.408 1.781-4.295 4.056-4.295h2.207v3.522h-1.976c-.516 0-.668.297-.668.705v1.63h2.643v3.119h-2.643v7.161H17.5a2.503 2.503 0 002.499-2.495V2.496A2.502 2.502 0 0017.5 0" fill="#402F8F" mask="url(#facebook_svg__b)"></path></g></svg></a></li><li><a href="https://www.instagram.com/libra/"><svg width="20" height="20"><g fill="#402F8F" fill-rule="evenodd"><path d="M10 0C7.284 0 6.944.012 5.877.06 4.813.11 4.086.278 3.45.525a4.893 4.893 0 00-1.771 1.152A4.884 4.884 0 00.525 3.444C.278 4.08.109 4.804.06 5.867.012 6.932 0 7.272 0 9.984c0 2.712.012 3.052.06 4.117.049 1.062.218 1.788.465 2.423a4.89 4.89 0 001.154 1.768 4.893 4.893 0 001.771 1.152c.636.247 1.362.415 2.427.463 1.067.05 1.407.061 4.123.061s3.056-.012 4.123-.06c1.065-.049 1.791-.217 2.427-.464a4.893 4.893 0 001.771-1.152 4.884 4.884 0 001.154-1.768c.247-.635.416-1.36.465-2.423.048-1.065.06-1.405.06-4.117 0-2.712-.012-3.052-.06-4.117-.049-1.062-.218-1.788-.465-2.423a4.884 4.884 0 00-1.154-1.768A4.893 4.893 0 0016.55.524C15.914.277 15.187.11 14.123.061 13.056.01 12.716 0 10 0m0 1.799c2.67 0 2.986.01 4.04.059.976.043 1.506.206 1.858.343a3.1 3.1 0 011.15.747c.35.35.566.681.748 1.147.137.353.3.881.344 1.854.048 1.054.058 1.37.058 4.035 0 2.666-.01 2.981-.058 4.035-.044.973-.207 1.501-.344 1.854a3.088 3.088 0 01-.748 1.147 3.1 3.1 0 01-1.15.747c-.352.137-.882.3-1.857.343-1.055.049-1.371.059-4.041.059-2.67 0-2.986-.01-4.04-.059-.976-.043-1.506-.206-1.858-.343a3.1 3.1 0 01-1.15-.747 3.088 3.088 0 01-.748-1.147c-.137-.353-.3-.881-.344-1.854-.048-1.054-.058-1.37-.058-4.035 0-2.666.01-2.981.058-4.035.044-.973.207-1.501.344-1.854.182-.466.398-.798.748-1.147a3.1 3.1 0 011.15-.747c.352-.137.882-.3 1.857-.343C7.014 1.809 7.33 1.799 10 1.799"></path><path d="M10.135 13.447a3.33 3.33 0 01-3.333-3.328 3.33 3.33 0 013.333-3.328 3.33 3.33 0 013.333 3.328 3.33 3.33 0 01-3.333 3.328m0-8.455A5.13 5.13 0 005 10.119a5.13 5.13 0 005.135 5.127 5.13 5.13 0 005.135-5.127 5.13 5.13 0 00-5.135-5.127M16.4 5.192a1.199 1.199 0 11-2.398-.002 1.199 1.199 0 012.398.002"></path></g></svg></a></li><li><a href="https://www.linkedin.com/company/libra-association/"><svg width="20" height="20"><path d="M16.25 0H3.75C1.68 0 0 1.68 0 3.75v12.5C0 18.32 1.68 20 3.75 20h12.5c2.07 0 3.75-1.68 3.75-3.75V3.75C20 1.68 18.32 0 16.25 0zM6.184 16.977H3.077l-.018-9.303h3.107l.018 9.303zM4.552 6.457h-.018c-1.015 0-1.67-.7-1.67-1.571 0-.893.676-1.569 1.71-1.569 1.033 0 1.667.676 1.688 1.569 0 .871-.658 1.571-1.71 1.571zm12.404 10.52h-3.134v-5.054c0-1.223-.324-2.055-1.418-2.055-.835 0-1.286.562-1.503 1.106-.08.195-.102.462-.102.736v5.267H7.65l-.018-9.303h3.15l.017 1.313c.403-.622 1.073-1.502 2.678-1.502 1.989 0 3.476 1.298 3.476 4.09v5.402h.003z" fill="#402F8F" fill-rule="nonzero"></path></svg></a></li><li><a href="https://github.com/libra/libra"><svg width="20" height="20"><path d="M15.939 15.913a8.375 8.375 0 01-3.444 2.08v-1.496c0-.787-.27-1.365-.81-1.736a8.93 8.93 0 00.933-.136c.283-.058.581-.143.898-.254.315-.11.598-.242.849-.395.25-.152.492-.35.723-.594.23-.244.424-.52.58-.829.157-.308.28-.679.372-1.111.091-.433.137-.909.137-1.429 0-1.007-.33-1.865-.986-2.574.298-.78.266-1.628-.098-2.544l-.244-.03c-.17-.019-.474.052-.913.215-.44.162-.933.429-1.48.8a8.997 8.997 0 00-2.412-.323c-.84 0-1.64.108-2.402.322a8.48 8.48 0 00-.982-.58 5.146 5.146 0 00-.742-.312 2.583 2.583 0 00-.825-.112.621.621 0 00-.098.02c-.365.923-.398 1.77-.097 2.544-.659.709-.987 1.567-.987 2.574 0 .52.045.996.137 1.429.09.432.214.803.37 1.111.157.309.35.585.582.829.23.244.472.442.722.594.251.153.534.285.85.395.316.111.615.196.899.254.283.058.593.104.932.136-.534.365-.8.943-.8 1.736v1.525a8.364 8.364 0 01-3.541-2.11 8.331 8.331 0 01-2.46-5.93c0-1.13.222-2.229.659-3.26a8.366 8.366 0 011.8-2.667A8.364 8.364 0 0110 1.599a8.37 8.37 0 015.939 2.456 8.366 8.366 0 011.8 2.666c.437 1.032.66 2.13.66 3.263a8.332 8.332 0 01-2.46 5.93M10 0C4.477 0 0 4.47 0 9.984s4.477 9.984 10 9.984 10-4.47 10-9.984S15.523 0 10 0" fill="#402F8F" fill-rule="evenodd"></path></svg></a></li></ul><a class="newsletter_2ba1" style="background-image:url(&#x27;/img/shared/newsletter.svg&#x27;)" href="https://developers.libra.org/newsletter_form" target="_blank" type="button">Join the Newsletter</a></div></div><div class="copyright_esf1">©2020 Libra Association</div></div></footer></div>
</div>

<script src="/styles.dec398a8.js"></script>

<script src="/runtime~main.a042d6de.js"></script>

<script src="/main.ed02c268.js"></script>

<script src="/1.a2c692f0.js"></script>

<script src="/1be78505.7f9abe94.js"></script>

<script src="/ec1ed54d.642a5f79.js"></script>

<script src="/17896441.c49eb8c6.js"></script>

<script src="/c0102118.a83626c9.js"></script>


</body>
</html>